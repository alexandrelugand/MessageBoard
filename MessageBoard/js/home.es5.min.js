"use strict";(function(){var n=angular.module("messageBoard",["ngRoute"]);n.config(["$routeProvider",function(n){n.when("/",{controller:"topicsController",controllerAs:"home",templateUrl:"/templates/topicsView.html"}).when("/newmessage",{controller:"newTopicController",controllerAs:"newTopic",templateUrl:"/templates/newTopicView.html"}).when("/message/:id",{controller:"singleTopicController",controllerAs:"singleTopic",templateUrl:"/templates/singleTopicView.html"}).otherwise({redirectTo:"/"})}]);n.factory("dataService",["$http","$q",function(n,t){function e(n){var t=null;return $.each(i,function(i,r){if(r.id==n)return t=r,!1}),t}var i=[],r=!1,u=function(){return r},f=function(){var u=t.defer();return n.get("/api/v1/topics?includeReplies=true").then(function(n){angular.copy(n.data,i);r=!0;u.resolve()},function(){u.reject()}),u.promise},o=function(r){var u=t.defer();return n.post("/api/v1/topics",r).then(function(n){var t=n.data;i.splice(0,0,t);u.resolve(t)},function(){u.reject()}),u.promise},s=function(n){var i=t.defer(),r;return u()?(r=e(n),r?i.resolve(r):i.reject()):f().then(function(){var t=e(n);t?i.resolve(t):i.reject()},function(){i.reject()}),i.promise},h=function(i,r){var u=t.defer();return n.post("/api/v1/topics/"+i.id+"/replies",r).then(function(n){i.replies==null&&(i.replies=[]);i.replies.push(n.data);u.resolve(n.data)},function(){u.reject()}),u.promise};return{topics:i,getTopics:f,addTopic:o,isReady:u,getTopicById:s,saveReply:h}}]);n.controller("topicsController",["dataService",function(n){var t=this;t.data=n;t.isBusy=!1;n.isReady()||(t.isBusy=!0,n.getTopics().then(function(){},function(){alert("Could not load topics")}).then(function(){t.isBusy=!1}))}]);n.controller("newTopicController",["$window","dataService",function(n,t){var i=this;i.topic={};i.save=function(){t.addTopic(i.topic).then(function(){n.location="#/"},function(){alert("Cannot save the new topic")})}}]);n.controller("singleTopicController",["$window","dataService","$routeParams",function(n,t,i){var r=this;r.topic=null;r.reply={};t.getTopicById(i.id).then(function(n){r.topic=n},function(){n.location="#/"});r.addReply=function(){t.saveReply(r.topic,r.reply).then(function(){r.reply.body=""},function(){alert("Cannot save the new reply")})}}])})();